<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SORTING HAT:ÏòÅÌôîÏ∂îÏ≤ú</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
            rel="stylesheet"
    />
    <link href="../static/head-bar.css" rel="stylesheet"/>
    <link href="../static/DP.css" rel="stylesheet"/>
    <link href="../static/star.css" rel="stylesheet"/>
    <link href="../static/modal.css" rel="stylesheet"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        body {
            background-color: black;
            color: white;
            font-size: 14px;
        }

        .movielist {
            max-width: 1500px;
            width: 100%;
            margin: 0 auto;
        }

        ul {
            font-size: 0;
        }

        li {
            display: inline-block;
            vertical-align: top;
            width: 25%;
        }

        li > a {
            display: block;
            width: auto;
            text-decoration: none;
            margin: 5px;
        }

        li > a .screen {
            position: relative;
            overflow: hidden;
        }

        li > a .screen .top {
            position: absolute;
            bottom: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 26px;
            font-weight: bold;

        }

        li > a .screen .middle {
            position: absolute;
            top: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 12px;

        }

        li > a .screen .bottom {
            position: absolute;
            top: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 12px;


        }

        li > a .screen img {
            width: 100%;
        }

        li > a:hover .top {
            bottom: 52%;
        }

        li > a:hover .middle {
            top: 52%;
        }

        li > a:hover .bottom {
            top: 60%;
        }

        li > a .screen::after {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .8);
            z-index: 1;
            opacity: 0;
            transition: all .35s;
        }

        li > a:hover .screen::after {
            opacity: 1;
        }

        /*
        .wrap-movie{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        .movie-post{
            background-color: white;
            width: 350px;
            height: 450px;
            margin: 20px;

        }

        .movie-img{
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        */
    </style>
    <script>
        $(document).ready(function () {
            listing();
            click();
            $('.close_btn').click(function () {
                $('#modal-container').toggleClass('unstaged')
                $('#modal-container').toggleClass('opaque')
                $('.modal_vid_box').empty()
            });
            $('.modal_overlay').click(function () {
                $('#modal-container').toggleClass('unstaged')
                $('#modal-container').toggleClass('opaque')
                $('.modal_vid_box').empty()
            });
        });


        function click() {
            $('.movielist').click(function (e) { // ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ Î∂àÎü¨Ïò§Í∏∞
                let id = e.target.getAttribute('id'); // ÌÅ¥Î¶≠Ìïú Í≥≥Ïùò idÍ∞í Í∞ÄÏ†∏Ïò§Í∏∞
                $('.modal_vid_box').empty()
                $('.con_tx').empty()
                $.ajax({
                    type: 'GET',
                    url: '/update_post',
                    data: {id: id},
                    success: function (response) {
                        let rows = response['movies']
                        let m_id = rows[0]['_id']
                        let title = rows[0]['title']
                        let genre = rows[0]['genre']
                        let nation = rows[0]['nation']
                        let director = rows[0]['director']
                        let actor = rows[0]['actor']
                        let user_star = rows[0]['user_star']
                        let reviewer_star = rows[0]['reviewer_star']
                        let time = rows[0]['time']
                        let tx = rows[0]['tx']
                        let release = rows[0]['release']
                        let video_url = rows[0]['video_url']

                        let temp_html = `<h2 style="font-size: 2.2em">${title}</h2>
                                        <p>${tx}</p>
                                        <hr class="modal_hr"/>
                                        <div style="height: 10px"></div>
                                        <h3>ÏòÅÌôî ÏÉÅÏÑ∏ Ï†ïÎ≥¥</h3>
                                        <section class="detail_wrap">
                                            <article id="detail1">
                                                <span>Í¥ÄÎûåÍ∞ù ÌèâÏ†ê</span>
                                                <svg style="display: none">
                                                  <defs>
                                                    <symbol id="fivestars">
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(24)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(48)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(72)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(96)"
                                                      />
                                                    </symbol>
                                                  </defs>
                                                </svg>
                                                <div class="rating">
                                                  <div class="rating-bg" style="width: 90%"></div>
                                                  <progress class="rating-bg" value="${user_star}" max="10"></progress>
                                                  <svg><use xlink:href="#fivestars" /></svg>
                                                </div>
                                                <br/>
                                                <span>Ï†úÏûëÍµ≠Í∞Ä:</span> ${nation}<br/>
                                                <span>Ïû•Î•¥:</span> ${genre}<br/>
                                                <span>Í∞êÎèÖ:</span> ${director}
                                            </article>
                                            <article id="detail2">
                                                <span>ÌèâÎ°†Í∞Ä ÌèâÏ†ê</span>
                                                    <svg style="display: none">
                                                      <defs>
                                                        <symbol id="fivestars">
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(24)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(48)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(72)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(96)"
                                                          />
                                                        </symbol>
                                                      </defs>
                                                    </svg>
                                                    <div class="rating">
                                                      <div class="rating-bg" style="width: 90%"></div>
                                                      <progress class="rating-bg" value="${reviewer_star}" max="10"></progress>
                                                      <svg><use xlink:href="#fivestars" /></svg>
                                                </div>
                                                <br/>
                                                <span>Í∞úÎ¥âÏùºÏûê:</span> ${release}<br/>
                                                <span>ÏÉÅÏòÅÏãúÍ∞Ñ:</span> ${time}<br/>
                                                <span>Ï∂úÏó∞:</span> ${actor}
                                            </article>
                                        </section>
                                        <div style="height: 25px"></div>
                                        <hr class="modal_hr"/>
                                        <div style="height: 10px"></div>
                                            <section id="comment_input_wrap">
                                                <form class="input-group" name="f_comment" action="/comment/add" method="post" onsubmit="return check_comment()">
                                                    <button class="good-btn" onclick="sel_goodBtn()" type="button">
                                                    </button>
                                                    <button class="bad-btn" onclick="sel_badBtn()" type="button">
                                                    </button>
                                                    <input type="hidden" name="sel_btn" class="sel-btn" value="false">
                                                    <input type="hidden" name="movie_id" value=${id}>
                                                    <input type="hidden" name="url" value="schedule">
                                                    <input
                                                            type="text"
                                                            class="name-input"
                                                            maxlength="8"
                                                            placeholder="ÎãâÎÑ§ÏûÑ"
                                                            name="u_name"
                                                    />
                                                    <input
                                                            type="text"
                                                            class="comment-input"
                                                            maxlength="50"
                                                            placeholder="ÌïúÏ§ÑÌèâ (50Ïûê Ï†úÌïú)"
                                                            name="comment"
                                                    />
                                                    <button class="submit-btn" type="=submit">Ï†úÏ∂úÌïòÍ∏∞</button>
                                                </form>
                                                <hr class="comment-hr"/>
                                                <div class="comment-box">
                                                </div>
                                            </section>
                                            <div style="height: 20px"></div>`
                        $('.con_tx').append(temp_html)
                        let video_html = `<iframe class="modal_vid" src=${video_url} allow='autoplay' frameborder='no' allowfullscreen></iframe>`
                        $('.modal_vid_box').append(video_html)
                        get_comments(m_id)
                        $('#modal-container').toggleClass('unstaged')
                        $('#modal-container').toggleClass('opaque')
                    }
                })
            });
        }

        function get_comments(m_id) { // DBÏóêÏÑú ÏΩîÎ©òÌä∏ Í∞ÄÏ†∏Ïò§Í∏∞
            console.log(m_id)
            $('.comment-box').empty()
            $.ajax({
                type: 'GET',
                url: '/comment/get',
                data: {m_id: m_id},
                success: function (response) {
                    let rows = response['comments']
                    for (let i = 0; i < rows.length; i++) {
                        let user = rows[i]['user'];
                        let button = rows[i]['button'];
                        let comment = rows[i]['comment'];
                        if (button === 'good') {
                            button = 'üîµ'
                        } else if (button === 'bad') {
                            button = 'üî¥'
                        }
                        let temp_html = `<div class="comment-wrap">
                                            <div id="color-sign">${button}</div>
                                            <div id="nickname">${user}</div>
                                            <div id="comment">
                                                ${comment}
                                            </div>
                                        </div>
                                        <hr class="comment-hr"/>`
                        $('.comment-box').append(temp_html)
                    }
                }
            })
        }


        function sel_goodBtn() {
            if (document.querySelector('.bad-btn').classList.contains('active')) {
                document.querySelector('.bad-btn').classList.toggle('active');
            }
            document.querySelector('.good-btn').classList.toggle('active');
            document.querySelector('.sel-btn').value = 'good';
            if (document.querySelector('.active') === null) {
                document.querySelector('.sel-btn').value = 'false';
            }
        }

        function sel_badBtn() {
            if (document.querySelector('.good-btn').classList.contains('active')) {
                document.querySelector('.good-btn').classList.toggle('active');
            }
            document.querySelector('.bad-btn').classList.toggle('active');
            document.querySelector('.sel-btn').value = 'bad';
            if (document.querySelector('.active') === null) {
                document.querySelector('.sel-btn').value = 'false';
            }
        }

        function check_comment() {
            if(f_comment.sel_btn.value === 'false') {
                alert("Ï¢ãÏïÑÏöî Ïã´Ïñ¥Ïöî Ï§ë ÌïòÎÇòÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
                return false;
            } else if (f_comment.u_name.value === "") {
                f_comment.u_name.focus();
                alert("ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
                return false;
            } else if (f_comment.comment.value === '') {
                f_comment.comment.focus();
                alert("ÏΩîÎ©òÌä∏Î•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî.");
                return false;
            } else return true;
        }

        function listing() { // DBÏóêÏÑú ÏòÅÌôî Ìï≠Î™© Í∞ÄÏ†∏Ïò§Í∏∞
            $('.movielist').empty()
            $.ajax({
                type: 'GET',
                url: '/update',
                data: {},
                success: function (response) {
                    let rows = response['movies']
                    for (let i = 0; i < rows.length; i++) {
                        if (rows[i]['showing'] !== 2) {
                            continue
                        }
                        let id = rows[i]['_id']
                        let image = rows[i]['image']
                        let title = rows[i]['title']
                        let user_star = rows[i]['user_star']
                        let reviewer_star = rows[i]['reviewer_star']
                        let release = rows[i]['release']

                        let temp_html = `<li>
                                            <a>
                                                <div class="screen" id=${id}>
                                                    <div class="top">${title}</div>
                                                    <div class="middle">${user_star} ${reviewer_star}</div>
                                                    <div class="bottom">${release}</div>
                                                    <img alt=${title} src=${image}>
                                                </div>
                                            </a>
                                        </li>`
                        $('.movielist').append(temp_html)
                    }
                }
            })
        }
    </script>
</head>
<body>
<!-- START HEAD BAR -->
<header class="head-bar">
    <h1>SORTING HAT</h1>
    <div class="hat-box"></div>
    <a href="recommend">ÏòÅÌôîÏ∂îÏ≤ú</a>
    <a href="showing">ÌòÑÏû¨ÏÉÅÏòÅÏûë</a>
    <a href="schedule">ÏÉÅÏòÅÏòàÏ†ïÏûë</a>
</header>
<!-- END HEAD BAR-->

<section class="cur-box">
    <h1>ÏÉÅÏòÅ ÏòàÏ†ïÏûë</h1>
    <article class="movielist">
    </article>
</section>

<!-- START MODAL-->
<div id="modal-container" class="modal unstaged">
    <div class="modal_overlay"></div>
    <div class="modal_content_wrap">
        <div class="modal_content">
            <div class="modal_vid_box">
            </div>

            <button class="close_btn">
                <img class="close_img" alt="ÎîõÍ∏∞" src="../static/icon/modal_exit_button.png"/>
            </button>
            <article class="con_tx">
            </article>
        </div>
        <div class="cover-bar"></div>
    </div>
</div>
<!-- END MODAL -->


</body>
</html>
