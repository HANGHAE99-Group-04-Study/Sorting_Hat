<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SORTING HAT:ì˜í™”ì¶”ì²œ</title>
    <link
            href="https://fonts.googleapis.com/css2?family=Do+Hyeon&display=swap"
            rel="stylesheet"
    />
    <link href="../static/head-bar.css" rel="stylesheet"/>
    <link href="../static/DP.css" rel="stylesheet"/>
    <link href="../static/star.css" rel="stylesheet"/>
    <link href="../static/modal.css" rel="stylesheet"/>
    <link href="../static/pagination.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.2/css/all.min.css"
          integrity="sha512-1sCRPdkRXhBV2PBLUdRb4tMg1w2YPf37qatUFeS7zlBy7jJI8Lf4VHwWfZZfpXtYSLy85pkm9GaYVYMfw5BC1A==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <style>
        body {
            background-color: black;
            color: white;
            font-size: 14px;
        }

        .movielist {
            max-width: 1500px;
            width: 100%;
            margin: 0 auto;
        }

        ul {
            font-size: 0;
        }

        .mvpost {
            display: inline-block;
            vertical-align: top;
            width: 25%;
        }

        .mvpost > a {
            display: block;
            width: auto;
            text-decoration: none;
            margin: 5px;
        }

        .mvpost > a .screen {
            position: relative;
            overflow: hidden;
        }

        .mvpost > a .screen .top {
            position: absolute;
            bottom: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 26px;
            font-weight: bold;

        }

        .mvpost > a .screen .middle {
            position: absolute;
            top: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 12px;

        }

        .mvpost > a .screen .bottom {
            position: absolute;
            top: 150%;
            left: 30px;
            z-index: 2;
            color: #fff;
            font-size: 12px;


        }

        .mvpost > a .screen img {
            width: 100%;
        }

        .mvpost > a:hover .top {
            bottom: 52%;
        }

        .mvpost > a:hover .middle {
            top: 52%;
        }

        .mvpost > a:hover .bottom {
            top: 60%;
        }

        .mvpost > a .screen::after {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, .8);
            z-index: 1;
            opacity: 0;
            transition: all .35s;
        }

        .mvpost > a:hover .screen::after {
            opacity: 1;
        }

        /*
        .wrap-movie{
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
        }
        .movie-post{
            background-color: white;
            width: 350px;
            height: 450px;
            margin: 20px;

        }

        .movie-img{
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        */
    </style>
    <script>
        $(document).ready(function () {
            listing();
            click();
            $('.close_btn').click(function () {
                $('#modal-container').toggleClass('unstaged')
                $('#modal-container').toggleClass('opaque')
                $('.modal_vid_box').empty()
            });
            $('.modal_overlay').click(function () {
                $('#modal-container').toggleClass('unstaged')
                $('#modal-container').toggleClass('opaque')
                $('.modal_vid_box').empty()
            });
        });


        function click() {
            $('.movielist').click(function (e) { // ìƒì„¸í˜ì´ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
                let id = e.target.getAttribute('id'); // í´ë¦­í•œ ê³³ì˜ idê°’ ê°€ì ¸ì˜¤ê¸°
                $('.modal_vid_box').empty()
                $('.con_tx').empty()
                $.ajax({
                    type: 'GET',
                    url: '/update_post',
                    data: {id: id},
                    success: function (response) {
                        let rows = response['movies']
                        let m_id = rows[0]['_id']
                        let title = rows[0]['title']
                        let genre = rows[0]['genre']
                        let nation = rows[0]['nation']
                        let director = rows[0]['director']
                        let actor = rows[0]['actor']
                        let user_star = rows[0]['user_star']
                        let reviewer_star = rows[0]['reviewer_star']
                        let time = rows[0]['time']
                        let tx = rows[0]['tx']
                        let release = rows[0]['release']
                        let video_url = rows[0]['video_url']

                        let temp_html = `<h2 style="font-size: 2.2em">${title}</h2>
                                        <p>${tx}</p>
                                        <hr class="modal_hr"/>
                                        <div style="height: 10px"></div>
                                        <h3>ì˜í™” ìƒì„¸ ì •ë³´</h3>
                                        <section class="detail_wrap">
                                            <article id="detail1">
                                                <span>ê´€ëŒê° í‰ì </span>
                                                <svg style="display: none">
                                                  <defs>
                                                    <symbol id="fivestars">
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(24)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(48)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(72)"
                                                      />
                                                      <path
                                                        d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                        fill="#191919"
                                                        fill-rule="evenodd"
                                                        transform="translate(96)"
                                                      />
                                                    </symbol>
                                                  </defs>
                                                </svg>
                                                <div class="rating">
                                                  <div class="rating-bg" style="width: 90%"></div>
                                                  <progress class="rating-bg" value="${user_star}" max="10"></progress>
                                                  <svg><use xlink:href="#fivestars" /></svg>
                                                </div>
                                                <br/>
                                                <span>ì œì‘êµ­ê°€:</span> ${nation}<br/>
                                                <span>ì¥ë¥´:</span> ${genre}<br/>
                                                <span>ê°ë…:</span> ${director}
                                            </article>
                                            <article id="detail2">
                                                <span>í‰ë¡ ê°€ í‰ì </span>
                                                    <svg style="display: none">
                                                      <defs>
                                                        <symbol id="fivestars">
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(24)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(48)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(72)"
                                                          />
                                                          <path
                                                            d="M12 .587l3.668 7.568 8.332 1.151-6.064 5.828 1.48 8.279-7.416-3.967-7.417 3.967 1.481-8.279-6.064-5.828 8.332-1.151z M0 0 h24 v24 h-24 v-24"
                                                            fill="#191919"
                                                            fill-rule="evenodd"
                                                            transform="translate(96)"
                                                          />
                                                        </symbol>
                                                      </defs>
                                                    </svg>
                                                    <div class="rating">
                                                      <div class="rating-bg" style="width: 90%"></div>
                                                      <progress class="rating-bg" value="${reviewer_star}" max="10"></progress>
                                                      <svg><use xlink:href="#fivestars" /></svg>
                                                </div>
                                                <br/>
                                                <span>ê°œë´‰ì¼ì:</span> ${release}<br/>
                                                <span>ìƒì˜ì‹œê°„:</span> ${time}<br/>
                                                <span>ì¶œì—°:</span> ${actor}
                                            </article>
                                        </section>
                                        <div style="height: 25px"></div>
                                        <hr class="modal_hr"/>
                                        <div style="height: 10px"></div>
                                            <section id="comment_input_wrap">
                                                <form class="input-group" name="f_comment" action="/comment/add" method="post" onsubmit="return check_comment()">
                                                    <button class="good-btn" onclick="sel_goodBtn()" type="button">
                                                    </button>
                                                    <button class="bad-btn" onclick="sel_badBtn()" type="button">
                                                    </button>
                                                    <input type="hidden" name="sel_btn" class="sel-btn" value="false">
                                                    <input type="hidden" name="movie_id" value=${id}>
                                                    <input type="hidden" name="url" value="schedule">
                                                    <input
                                                            type="text"
                                                            class="name-input"
                                                            maxlength="8"
                                                            placeholder="ë‹‰ë„¤ì„"
                                                            name="u_name"
                                                    />
                                                    <input
                                                            type="text"
                                                            class="comment-input"
                                                            maxlength="50"
                                                            placeholder="í•œì¤„í‰ (50ì ì œí•œ)"
                                                            name="comment"
                                                    />
                                                    <button class="submit-btn" type="=submit">ì œì¶œí•˜ê¸°</button>
                                                </form>
                                                <hr class="comment-hr"/>
                                                <div class="comment-box">
                                                </div>
                                            </section>
                                            <div style="height: 20px"></div>`
                        $('.con_tx').append(temp_html)
                        let video_html = `<iframe class="modal_vid" src=${video_url} allow='autoplay' frameborder='no' allowfullscreen></iframe>`
                        $('.modal_vid_box').append(video_html)
                        get_comments(m_id)
                        $('#modal-container').toggleClass('unstaged')
                        $('#modal-container').toggleClass('opaque')
                    }
                })
            });
        }

        function get_comments(m_id) { // DBì—ì„œ ì½”ë©˜íŠ¸ ê°€ì ¸ì˜¤ê¸°
            console.log(m_id)
            $('.comment-box').empty()
            $.ajax({
                type: 'GET',
                url: '/comment/get',
                data: {m_id: m_id},
                success: function (response) {
                    let rows = response['comments']
                    for (let i = 0; i < rows.length; i++) {
                        let user = rows[i]['user'];
                        let button = rows[i]['button'];
                        let comment = rows[i]['comment'];
                        if (button === 'good') {
                            button = 'ğŸ”µ'
                        } else if (button === 'bad') {
                            button = 'ğŸ”´'
                        }
                        let temp_html = `<div class="comment-wrap">
                                            <div id="color-sign">${button}</div>
                                            <div id="nickname">${user}</div>
                                            <div id="comment">
                                                ${comment}
                                            </div>
                                        </div>
                                        <hr class="comment-hr"/>`
                        $('.comment-box').append(temp_html)
                    }
                }
            })
        }


        function sel_goodBtn() {
            if (document.querySelector('.bad-btn').classList.contains('active')) {
                document.querySelector('.bad-btn').classList.toggle('active');
            }
            document.querySelector('.good-btn').classList.toggle('active');
            document.querySelector('.sel-btn').value = 'good';
            if (document.querySelector('.active') === null) {
                document.querySelector('.sel-btn').value = 'false';
            }
        }

        function sel_badBtn() {
            if (document.querySelector('.good-btn').classList.contains('active')) {
                document.querySelector('.good-btn').classList.toggle('active');
            }
            document.querySelector('.bad-btn').classList.toggle('active');
            document.querySelector('.sel-btn').value = 'bad';
            if (document.querySelector('.active') === null) {
                document.querySelector('.sel-btn').value = 'false';
            }
        }

        function check_comment() {
            if(f_comment.sel_btn.value === 'false') {
                alert("ì¢‹ì•„ìš” ì‹«ì–´ìš” ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
                return false;
            } else if (f_comment.u_name.value === "") {
                f_comment.u_name.focus();
                alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”.");
                return false;
            } else if (f_comment.comment.value === '') {
                f_comment.comment.focus();
                alert("ì½”ë©˜íŠ¸ë¥¼ ì‘ì„±í•˜ì„¸ìš”.");
                return false;
            } else return true;
        }

        function listing() { // DBì—ì„œ ì˜í™” í•­ëª© ê°€ì ¸ì˜¤ê¸°
            $('.movielist').empty()
            $.ajax({
                type: 'GET',
                url: '/update',
                data: {},
                success: function (response) {
                    let rows = response['movies']
                    for (let i = 0; i < rows.length; i++) {
                        if (rows[i]['showing'] !== 2) {
                            continue
                        }
                        let id = rows[i]['_id']
                        let image = rows[i]['image']
                        let title = rows[i]['title']
                        let user_star = rows[i]['user_star']
                        let reviewer_star = rows[i]['reviewer_star']
                        let release = rows[i]['release']

                        let temp_html = `<li class="mvpost">
                                            <a>
                                                <div class="screen" id=${id}>
                                                    <div class="top">${title}</div>
                                                    <div class="middle">${user_star} ${reviewer_star}</div>
                                                    <div class="bottom">${release}</div>
                                                    <img alt=${title} src=${image}>
                                                </div>
                                            </a>
                                        </li>`
                        $('.movielist').append(temp_html)
                    }

                    // í˜ì´ì§€ë„¤ì´ì…˜ ì‹œì‘
                        const rowsPerPage = 16 // í•œ í˜ì´ì§€ì— ì¶œë ¥ë˜ëŠ” ê°œìˆ˜
                        const newRows = document.querySelectorAll('.movielist li')
                        const rowsCount = newRows.length
                        const pageCount = Math.ceil(rowsCount / rowsPerPage)
                        const numbers = document.querySelector('#numbers')

                        const prevPageBtn = document.querySelector('.pg .fa-angle-left')
                        const nextPageBtn = document.querySelector('.pg .fa-angle-right')
                        let pageActiveIdx = 0 //í˜„ì¬ ë³´ê³  ìˆëŠ” í˜ì´ì§€ ê·¸ë£¹ ë²ˆí˜¸
                        let maxPageNum = 3 //í˜ì´ì§€ ê·¸ë£¹ì˜ ìµœëŒ€ ê°œìˆ˜
                        // í˜ì´ì§€ë„¤ì´ì…˜ ìƒì„±
                       for (let i = 1; i <= pageCount; i++) {
                            numbers.innerHTML += `<li><a href="" onclick="javascript:window.scrollTo(0,0)">${i}</a></li>`

                        }
                        const numberBtn = numbers.querySelectorAll('a')

                        //í˜ì´ì§€ë„¤ì´ì…˜ ë²ˆí˜¸ ê°ì¶”ê¸°
                        for(nb of numberBtn){
                            nb.style.display = 'none'
                        }
                        numberBtn.forEach((item,idx) => {
                            item.addEventListener('click', (e) => {
                                e.preventDefault()
                                displayRow(idx)
                            })
                        })

                        function displayRow(idx) {
                            let start = idx * rowsPerPage
                            let end = start + rowsPerPage
                            let rowsArray = [...newRows]

                            for(ra of rowsArray) {
                                ra.style.display = 'none'
                            }
                            let newRow = rowsArray.slice(start, end)
                            for(nr of newRow){
                                nr.style.display = ''
                            }
                            for(nb of numberBtn){
                                nb.classList.remove('active')
                            }
                            numberBtn[idx].classList.add('active')
                        }
                        displayRow(0)

                        //í˜ì´ì§€ë„¤ì´ì…˜ ê·¸ë£¹ í‘œì‹œ í•¨ìˆ˜
                        function displayPage(num){
                            //í˜ì´ì§€ë„¤ì´ì…˜ ë²ˆí˜¸ ê°ì¶”ê¸°
                            for(nb of numberBtn){
                                nb.style.display = 'none'
                            }
                            let totalPageCount = Math.ceil(pageCount/maxPageNum)

                            let pageArr = [...numberBtn]
                            let start = num * maxPageNum
                            let end = start + maxPageNum
                            let pageListArr = pageArr.slice(start, end)

                            for(item of pageListArr){
                                item.style.display = 'block'
                            }
                            if(pageActiveIdx === 0){
                                prevPageBtn.style.display = 'none'
                            }else{
                                prevPageBtn.style.display = 'block'
                            }
                            if(pageActiveIdx === totalPageCount - 1){
                                nextPageBtn.style.display = 'none'
                            }else{
                                nextPageBtn.style.display = 'block'
                            }

                        }
                        displayPage(0)

                        nextPageBtn.addEventListener('click',()=>{
                            let nextPageNum = pageActiveIdx * maxPageNum + maxPageNum
                            displayRow(nextPageNum)
                            ++pageActiveIdx
                            displayPage(pageActiveIdx)
                            window.scrollTo(0,0)
                        })
                        prevPageBtn.addEventListener('click',()=>{
                            let prevPageNum = pageActiveIdx * maxPageNum - maxPageNum
                            displayRow(prevPageNum)
                            --pageActiveIdx
                            displayPage(pageActiveIdx)
                            window.scrollTo(0,0)
                        })
                        //í˜ì´ì§€ë„¤ì´ì…˜ ë

                }
            })
        }
    </script>
    <link rel="stylesheet" href="../static/showing.css">
</head>
<body>
    <!-- START HEAD BAR -->
    <header class="head-bar">
        <h1>SORTING HAT</h1>
        <div class="hat-box"></div>
        <a href="recommend">ì˜í™”ì¶”ì²œ</a>
        <a href="showing">í˜„ì¬ìƒì˜ì‘</a>
        <a href="schedule">ìƒì˜ì˜ˆì •ì‘</a>
    </header>
    <!-- END HEAD BAR-->

    <section class="cur-box">
        <h1>ìƒì˜ ì˜ˆì •ì‘</h1>
        <article class="movielist">

        </article>


        <!--í˜ì´ì§€ë„¤ì´ì…˜ ì‹œì‘-->
        <div class="pg">
            <i class="fa-solid fa-angle-left" style="display: none"></i>
            <ol id="numbers">

            </ol>
            <i class="fa-solid fa-angle-right" style="display: none"></i>
        </div>
        <!--í˜ì´ì§€ë„¤ì´ì…˜ ë-->

    </section>

    <!-- START MODAL-->
    <div id="modal-container" class="modal unstaged">
        <div class="modal_overlay"></div>
        <div class="modal_content_wrap">
            <div class="modal_content">
                <div class="modal_vid_box">
                </div>

                <button class="close_btn">
                    <img class="close_img" alt="ë”›ê¸°" src="../static/icon/modal_exit_button.png"/>
                </button>
                <article class="con_tx">
                </article>
            </div>
            <div class="cover-bar"></div>
        </div>
    </div>
    <!-- END MODAL -->
</body>
</html>
